{"ast":null,"code":"import ProductsFilter from '@/components/ProductsFilter.vue';\nimport ProductsList from '@/components/ProductsList.vue';\nimport BasePagination from '@/components/BasePagination.vue';\nexport default {\n  components: {\n    ProductsFilter,\n    ProductsList,\n    BasePagination\n  },\n\n  data() {\n    return {\n      page: 1,\n      productsPerPage: 6,\n      filters: {\n        filterPriceFrom: 0,\n        filterPriceTo: 0,\n        filterCategoryId: 0,\n        filterColorId: [],\n        filterMaterialId: [],\n        filterSeasonId: []\n      }\n    };\n  },\n\n  computed: {\n    productsData() {\n      return this.$store.state.productsData;\n    },\n\n    products() {\n      return this.productsData ? this.productsData.items.map(product => {\n        return { ...product,\n          images: product.colors.flatMap(color => color.gallery).filter(img => img !== null)\n        };\n      }) : [];\n    },\n\n    total() {\n      return this.productsData ? this.productsData.pagination.total : 0;\n    },\n\n    isLoading() {\n      return this.$store.state.isLoading;\n    },\n\n    isLoadingFailed() {\n      return this.$store.state.isLoadingFailed;\n    }\n\n  },\n  methods: {\n    loadProducts() {\n      this.$store.dispatch('loadProducts', {\n        page: this.page,\n        limit: this.productsPerPage,\n        minPrice: this.filters.filterPriceFrom,\n        maxPrice: this.filters.filterPriceTo,\n        categoryId: this.filters.filterCategoryId,\n        materialIds: this.filters.filterMaterialId,\n        seasonIds: this.filters.filterSeasonId,\n        colorIds: this.filters.filterColorId\n      });\n    },\n\n    setFilters(filters) {\n      this.filters = filters;\n    },\n\n    setPage(page) {\n      this.page = page;\n    }\n\n  },\n  watch: {\n    filters() {\n      this.page = 1;\n      this.loadProducts();\n    },\n\n    page() {\n      this.loadProducts();\n    },\n\n    '$route'() {\n      this.loadProducts();\n    }\n\n  },\n\n  created() {\n    this.filters.filterCategoryId = this.$route.query.categoryId || 0;\n    this.loadProducts();\n  }\n\n};","map":{"version":3,"mappings":"AAgCA,OAAOA,cAAP,MAA2B,iCAA3B;AACA,OAAOC,YAAP,MAAyB,+BAAzB;AACA,OAAOC,cAAP,MAA2B,iCAA3B;AAEA,eAAe;AACbC,YAAU,EAAE;AAAEH,kBAAF;AAAkBC,gBAAlB;AAAgCC;AAAhC,GADC;;AAEbE,MAAI,GAAG;AACL,WAAO;AACLC,UAAI,EAAE,CADD;AAELC,qBAAe,EAAE,CAFZ;AAGLC,aAAO,EAAE;AACPC,uBAAe,EAAE,CADV;AAEPC,qBAAa,EAAE,CAFR;AAGPC,wBAAgB,EAAE,CAHX;AAIPC,qBAAa,EAAE,EAJR;AAKPC,wBAAgB,EAAE,EALX;AAMPC,sBAAc,EAAE;AANT;AAHJ,KAAP;AAYD,GAfY;;AAgBbC,UAAQ,EAAE;AACRC,gBAAY,GAAG;AACb,aAAO,KAAKC,MAAL,CAAYC,KAAZ,CAAkBF,YAAzB;AACD,KAHO;;AAIRG,YAAQ,GAAG;AACT,aAAO,KAAKH,YAAL,GAAoB,KAAKA,YAAL,CAAkBI,KAAlB,CAAwBC,GAAxB,CAA6BC,OAAD,IAAa;AAClE,eAAO,EACL,GAAGA,OADE;AAELC,gBAAM,EAAED,OAAO,CAACE,MAAR,CAAeC,OAAf,CAAwBC,KAAD,IAAWA,KAAK,CAACC,OAAxC,EAAiDC,MAAjD,CAAyDC,GAAD,IAASA,GAAE,KAAM,IAAzE;AAFH,SAAP;AAID,OAL0B,CAApB,GAKF,EALL;AAMD,KAXO;;AAYRC,SAAK,GAAG;AACN,aAAO,KAAKd,YAAL,GAAoB,KAAKA,YAAL,CAAkBe,UAAlB,CAA6BD,KAAjD,GAAyD,CAAhE;AACD,KAdO;;AAeRE,aAAS,GAAG;AACV,aAAO,KAAKf,MAAL,CAAYC,KAAZ,CAAkBc,SAAzB;AACD,KAjBO;;AAkBRC,mBAAe,GAAG;AAChB,aAAO,KAAKhB,MAAL,CAAYC,KAAZ,CAAkBe,eAAzB;AACD;;AApBO,GAhBG;AAsCbC,SAAO,EAAE;AACPC,gBAAY,GAAG;AACb,WAAKlB,MAAL,CAAYmB,QAAZ,CAAqB,cAArB,EAAqC;AACnC9B,YAAI,EAAE,KAAKA,IADwB;AAEnC+B,aAAK,EAAE,KAAK9B,eAFuB;AAGnC+B,gBAAQ,EAAE,KAAK9B,OAAL,CAAaC,eAHY;AAInC8B,gBAAQ,EAAE,KAAK/B,OAAL,CAAaE,aAJY;AAKnC8B,kBAAU,EAAE,KAAKhC,OAAL,CAAaG,gBALU;AAMnC8B,mBAAW,EAAE,KAAKjC,OAAL,CAAaK,gBANS;AAOnC6B,iBAAS,EAAE,KAAKlC,OAAL,CAAaM,cAPW;AAQnC6B,gBAAQ,EAAE,KAAKnC,OAAL,CAAaI;AARY,OAArC;AAUD,KAZM;;AAaPgC,cAAU,CAACpC,OAAD,EAAU;AAClB,WAAKA,OAAL,GAAeA,OAAf;AACD,KAfM;;AAgBPqC,WAAO,CAACvC,IAAD,EAAO;AACZ,WAAKA,IAAL,GAAYA,IAAZ;AACF;;AAlBO,GAtCI;AA0DbwC,OAAK,EAAE;AACLtC,WAAO,GAAG;AACR,WAAKF,IAAL,GAAY,CAAZ;AACA,WAAK6B,YAAL;AACD,KAJI;;AAKL7B,QAAI,GAAG;AACL,WAAK6B,YAAL;AACD,KAPI;;AAQL,eAAW;AACT,WAAKA,YAAL;AACF;;AAVK,GA1DM;;AAsEbY,SAAO,GAAG;AACR,SAAKvC,OAAL,CAAaG,gBAAb,GAAgC,KAAKqC,MAAL,CAAYC,KAAZ,CAAkBT,UAAlB,IAAgC,CAAhE;AACA,SAAKL,YAAL;AACF;;AAzEa,CAAf","names":["ProductsFilter","ProductsList","BasePagination","components","data","page","productsPerPage","filters","filterPriceFrom","filterPriceTo","filterCategoryId","filterColorId","filterMaterialId","filterSeasonId","computed","productsData","$store","state","products","items","map","product","images","colors","flatMap","color","gallery","filter","img","total","pagination","isLoading","isLoadingFailed","methods","loadProducts","dispatch","limit","minPrice","maxPrice","categoryId","materialIds","seasonIds","colorIds","setFilters","setPage","watch","created","$route","query"],"sourceRoot":"","sources":["D:\\задание\\final_examination_vue.js_dpo\\project\\mue\\src\\pages\\MainPage.vue"],"sourcesContent":["<template>\r\n  <main class=\"content container\">\r\n    <div class=\"content__top\">\r\n\r\n      <div class=\"content__row\">\r\n        <h1 class=\"content__title\">\r\n          Каталог\r\n        </h1>\r\n        <span class=\"content__info\">\r\n          Количество товаров: {{ total }}\r\n        </span>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"content__catalog\">\r\n      <products-filter :filters=\"filters\" @change-filters=\"setFilters\"></products-filter>\r\n\r\n      <section class=\"catalog\">\r\n        <div class=\"loader-wrapper\" v-if=\"isLoading\">\r\n          <base-loader></base-loader>\r\n        </div>\r\n        <h2 v-else-if=\"isLoadingFailed\">Возникла ошибка при загрузке товаров. Попробуйте позже.</h2>\r\n        <h2 v-else-if=\"!products.length\">Нет товаров по вашему запросу. Попробуйте поискать что-нибудь другое!</h2>\r\n        <products-list :products=\"products\" v-else></products-list>\r\n\r\n        <base-pagination :page=\"page\" :perPage=\"productsPerPage\" :total=\"total\" @change-page=\"setPage\" v-if=\"products.length\"></base-pagination>\r\n      </section>\r\n    </div>\r\n  </main>\r\n</template>\r\n\r\n<script>\r\nimport ProductsFilter from '@/components/ProductsFilter.vue';\r\nimport ProductsList from '@/components/ProductsList.vue';\r\nimport BasePagination from '@/components/BasePagination.vue';\r\n\r\nexport default {\r\n  components: { ProductsFilter, ProductsList, BasePagination },\r\n  data() {\r\n    return {\r\n      page: 1,\r\n      productsPerPage: 6,\r\n      filters: {\r\n        filterPriceFrom: 0,\r\n        filterPriceTo: 0,\r\n        filterCategoryId: 0,\r\n        filterColorId: [],\r\n        filterMaterialId: [],\r\n        filterSeasonId: [],\r\n      },\r\n    }\r\n  },\r\n  computed: {\r\n    productsData() {\r\n      return this.$store.state.productsData;\r\n    },\r\n    products() {\r\n      return this.productsData ? this.productsData.items.map((product) => {\r\n        return {\r\n          ...product,\r\n          images: product.colors.flatMap((color) => color.gallery).filter((img) => img !== null)\r\n        }\r\n      }) : [];\r\n    },\r\n    total() {\r\n      return this.productsData ? this.productsData.pagination.total : 0;\r\n    },\r\n    isLoading() {\r\n      return this.$store.state.isLoading;\r\n    },\r\n    isLoadingFailed() {\r\n      return this.$store.state.isLoadingFailed;\r\n    },\r\n  },\r\n  methods: {\r\n    loadProducts() {\r\n      this.$store.dispatch('loadProducts', {\r\n        page: this.page,\r\n        limit: this.productsPerPage,\r\n        minPrice: this.filters.filterPriceFrom,\r\n        maxPrice: this.filters.filterPriceTo,\r\n        categoryId: this.filters.filterCategoryId,\r\n        materialIds: this.filters.filterMaterialId,\r\n        seasonIds: this.filters.filterSeasonId,\r\n        colorIds: this.filters.filterColorId\r\n      });\r\n    },\r\n    setFilters(filters) {\r\n      this.filters = filters;\r\n    },\r\n    setPage(page) {\r\n      this.page = page;\r\n    }\r\n  },\r\n  watch: {\r\n    filters() {\r\n      this.page = 1;\r\n      this.loadProducts();\r\n    },\r\n    page() {\r\n      this.loadProducts();\r\n    },\r\n    '$route'() {\r\n      this.loadProducts();\r\n    }\r\n  },\r\n  created() {\r\n    this.filters.filterCategoryId = this.$route.query.categoryId || 0;\r\n    this.loadProducts();\r\n  }\r\n}\r\n</script>"]},"metadata":{},"sourceType":"module"}